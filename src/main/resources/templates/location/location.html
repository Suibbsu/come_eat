<!DOCTYPE html>
<html　xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지역별 맛집</title>
    <link rel="stylesheet" href="/css/location.css">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e951a9675edffd5bbc4faec7164c3441&libraries=services"></script>
</head>
<body>
	<th:block th:include="common/header"></th:block>
    <div class="content-wrap">
        <div class="content-title">지역별 맛집</div>
        <div class="location-btn">
            <div>
                <a href="#" class="btn lo-btn">서울</a>
            </div>
            <div>
                <a href="#" class="btn lo-btn">경기도</a>
            </div>
            <div>
                <a href="#" class="btn lo-btn">인천</a>
            </div>
            <div>
                <a href="/location/busan" class="btn lo-btn">부산</a>
            </div>
            <div>
                <a href="#" class="btn lo-btn">대구</a>
            </div>
            <div>
                <a href="#" class="btn lo-btn">김해</a>
            </div>
            <div>
                <a href="#" class="btn lo-btn">전주</a>
            </div>
            <div>
                <a href="/location/jeonnam" class="btn lo-btn">전남</a>
            </div>
            <div>
                <a href="#" class="btn lo-btn">충북</a>
            </div>
            <div>
                <a href="#" class="btn lo-btn">포항</a>
            </div>
            <div>
                <a href="#" class="btn lo-btn">영주</a>
            </div>
        </div>
        <div class="sub-title clear">
            서울 맛집
        </div>
        <div class="location-map">
            	<div id="map" style="width:100%;height:100%;"></div>
        </div>
        <div class="location-content-wrap"> 
            <div class="location-content">
                <a href="#">
                    <div class="location-img-box">
                        <img src="/">
                    </div>
                    <div class="location-content-info">
                        <p>맛집이름</p>
                        <p>맛집설명</p>
                        <div class="star">
                            <span class="material-icons-round">grade</span>
                            <span>4.5</span>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        
        <button class="btn" id="more-btn">더보기</button>
    </div>
    <th:block th:include="common/footer"></th:block>
    
    <script>
    	//상단 버튼 클릭한 버튼만 색상 변경
    	$(".lo-btn").on("click",function(){
    		$(".lo-btn").removeClass("active-btn");
    		$(this).addClass("active-btn");
    	});
    	
    	window.onload = function(){
    		$(".lo-btn").eq(0).click();
    		$("#more-btn").click();
    	};
    	
    	//카카오 지도 API
		var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
		var options = { //지도를 생성할 때 필요한 기본 옵션
			center: new kakao.maps.LatLng(37.566815192716994, 126.97865226139427), //지도의 중심좌표.
			level: 4 //지도의 레벨(확대, 축소 정도)
		};
		var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴
		
		//더보기버튼
		$("#more-btn").on("click",function(){
			const pageNo = Number($(this).val());
			$.ajax({
				url : "/location/busan",
				type : "get",
				data : {pageNo:pageNo},
				success : function(data){
					console.log(data);
					
					for(let i=0;i<data.length;i++){					
						const tr = $("<tr>");
						tr.addClass("tr-1");
						
						//클릭한 tr 위경도 가져와서 지도에 띄우기
						tr.on("click",function(){
							//클릭하자마자 마커객체생성
							const place = new naver.maps.LatLng(data[i].lat,data[i].lng);
							map.setCenter(place);
							marker.setPosition(place);
							console.log(data[i].lat,data[i].lng);
						});
						
						//썸네일띄우기
						const imgTd = $("<td>");
						const img = $("<img style = 'width:100%;'>");
						img.attr("src",data[i].thumb);
						imgTd.append(img);
						
						//상호명띄우기
						const titleTd = $("<td>");
						titleTd.text(data[i].mainTitle);
						
						//주소띄우기
						const addressTd = $("<td>");
						addressTd.text(data[i].address);
						
						//전화벙호
						const telTd = $("<td>");
						telTd.text(data[i].tel);
						
						//상세정보
						//const introTd = $("<td>");
						//introTd.text(data[i].intro);
						
						//tr.append(imgTd).append(titleTd).append(addressTd).append(telTd).append(introTd);
						tr.append(imgTd).append(titleTd).append(addressTd).append(telTd);
						$(".busan>table").append(tr);
					}
					//for문 끝나면 버튼에 더보기 클릭시 10개씩 나오게 설정
					$("#more-btn").val(pageNo+1);
				}
			});
		});
		
		
    </script>
</body>
</html>