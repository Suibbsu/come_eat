<!DOCTYPE html>
<html　xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지역별 맛집</title>
    <link rel="stylesheet" href="/css/location.css">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e951a9675edffd5bbc4faec7164c3441&libraries=services"></script>
</head>
<body>
	<th:block th:include="common/header"></th:block>
    <div class="content-wrap">
        <div class="content-title">지역별 맛집</div>
        <div class="location-btn">
            <div>
                <a href="/location/foodList?pageNo=1&lo=su" class="btn lo-btn" title="서울맛집">서울</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=kkd" class="btn lo-btn" title="서울맛집">경기도</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=ic" class="btn lo-btn" title="서울맛집">인천</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=bs" class="btn lo-btn" title="서울맛집">부산</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=dg" class="btn lo-btn" title="서울맛집">대구</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=kh" class="btn lo-btn" title="서울맛집">김해</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=jj" class="btn lo-btn" title="서울맛집">전주</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=jn" class="btn lo-btn" title="서울맛집">전남</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=cb" class="btn lo-btn" title="서울맛집">충북</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=ph" class="btn lo-btn" title="서울맛집">포항</a>
            </div>
            <div>
                <a href="/location/foodList?pageNo=1&lo=yj" class="btn lo-btn" title="영주맛집">영주</a>
            </div>
        </div>
        <div th:if="${list != null}">        
	        <div class="sub-title clear" th:text="${title}"></div>
	        <div class="location-map">
	            	<div id="map" style="width:100%;height:100%;"></div>
	        </div>
	        <div class="location-content-wrap"> 
	            <div class="location-content" th:each="location : ${list}">
	                <a th:href="@{/review/detailRestaurant(loNo=${location.loNo})}">
	                    <div class="location-img-box" th:style="'background-image:url(' + ${location.loThumb} + ');'">
	                    </div>
	                    <div class="location-content-info">
	                        <p th:text="${location.loTitle}"></p>
	                        <p th:text="${location.loInfo}"></p>
	                        <div class="star">
	                            <span class="material-icons-round">grade</span>
	                            <span>4.5</span>
	                        </div>
	                    </div>
	                </a>
	            </div>
	        </div>
	        <div class="board-navi" th:utext="${navi}"></div>
	        
	        
	        
        </div>
    </div>
    <th:block th:include="common/footer"></th:block>
    
    <script th:inline="javascript">
		//상단 버튼 클릭한 버튼만 색상 변경
		$(".lo-btn").on("click",function(){
			$(".lo-btn").removeClass("active-btn");
			$(this).addClass("active-btn");			
		});
		

		//지도
		window.onload = function(){
			const list = [[${list}]];
			const loCode = list[0].loCode;
			
			if(list.length != 0){

				//지도에는 전체위치 출력하기 위해 비동기 요청
				$.ajax({
					url : "/location/map",
					type : "get",
					data : {loCode:loCode},
					success : function(data){
						//카카오 지도 API
						var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
						var options = { //지도를 생성할 때 필요한 기본 옵션
							center: new kakao.maps.LatLng(data[0].loLat, data[0].loLng), //지도의 중심좌표.
							level: 10 //지도의 레벨(확대, 축소 정도)
						};
						var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴
						
						//마커
						for(let i=0; i<data.length;i++){
							//마커가 표시될 위치
							var markerPosition  = new kakao.maps.LatLng(data[i].loLat, data[i].loLng);
							//마커 생성
							var marker = new kakao.maps.Marker({
								position: markerPosition,
								clickable: true
							});
							//마커가 지도 위에 표시되도록 설정
							marker.setMap(map);
							
							//인포윈도우생성
							var iwContent = [
								"<div class='marker'>",
					            "<div>"+data[i].loTitle+"</div>",
					            "<div>"+data[i].loAddr+"</div>",
					        	"</div>"
							].join("");
							iwRemoveable = true;
							//인포윈도우 생성
							var infowindow = new kakao.maps.InfoWindow({
							    content : iwContent,
							    removable : iwRemoveable
							});
							
							//마커에 mouseover 이벤트와 mouseout 이벤트를 등록
						    kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
						    kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));

						 	// 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
						    function makeOverListener(map, marker, infowindow) {
						        return function() {
						            infowindow.open(map, marker);
						        };
						    }

						    // 인포윈도우를 닫는 클로저를 만드는 함수입니다 
						    function makeOutListener(infowindow) {
						        return function() {
						            infowindow.close();
						        };
						    }

						    
							/* //마커 위에 인포윈도우 표시(클릭이벤트설정)
							kakao.maps.event.addListener(marker, 'click', function() {
							      // 마커 위에 인포윈도우를 표시합니다
							      infowindow.open(map, marker);  
							});  */
						}
						
					}
				});
			}
		};

    </script>
</body>
</html>